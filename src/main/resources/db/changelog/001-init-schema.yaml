databaseChangeLog:

  - changeSet:
      id: 001-create-users
      author: Oleksii Morenets
      changes:
        - createTable:
            tableName: users
            columns:
              - column:
                  name: id
                  type: uuid
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: email
                  type: varchar(255)
                  constraints:
                    nullable: false
                    unique: true

  - changeSet:
      id: 002-create-units
      author: Oleksii Morenets
      changes:
        - createTable:
            tableName: units
            columns:
              - column:
                  name: id
                  type: uuid
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: rooms
                  type: int
                  constraints:
                    nullable: false
              - column:
                  name: type
                  type: varchar(20)
                  constraints:
                    nullable: false
              - column:
                  name: floor
                  type: int
                  constraints:
                    nullable: false
              - column:
                  name: base_cost
                  type: numeric(10,2)
                  constraints:
                    nullable: false
              - column:
                  name: description
                  type: varchar(500)
              - column:
                  name: active
                  type: boolean
                  defaultValueBoolean: true
                  constraints:
                    nullable: false

  - changeSet:
      id: 003-create-bookings
      author: Oleksii Morenets
      changes:
        - createTable:
            tableName: bookings
            columns:
              - column:
                  name: id
                  type: uuid
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: unit_id
                  type: uuid
                  constraints:
                    nullable: false
              - column:
                  name: user_id
                  type: uuid
                  constraints:
                    nullable: false
              - column:
                  name: start_date
                  type: date
                  constraints:
                    nullable: false
              - column:
                  name: end_date
                  type: date
                  constraints:
                    nullable: false
              - column:
                  name: status
                  type: varchar(30)
                  constraints:
                    nullable: false
              - column:
                  name: created_at
                  type: timestamp
                  constraints:
                    nullable: false
              - column:
                  name: expires_at
                  type: timestamp

        - addForeignKeyConstraint:
            baseTableName: bookings
            baseColumnNames: unit_id
            referencedTableName: units
            referencedColumnNames: id
            constraintName: fk_bookings_unit

        - addForeignKeyConstraint:
            baseTableName: bookings
            baseColumnNames: user_id
            referencedTableName: users
            referencedColumnNames: id
            constraintName: fk_bookings_user

  - changeSet:
      id: 004-create-payments
      author: Oleksii Morenets
      changes:
        - createTable:
            tableName: payments
            columns:
              - column:
                  name: id
                  type: uuid
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: booking_id
                  type: uuid
                  constraints:
                    nullable: false
              - column:
                  name: amount
                  type: numeric(10,2)
                  constraints:
                    nullable: false
              - column:
                  name: successful
                  type: boolean
                  constraints:
                    nullable: false
              - column:
                  name: created_at
                  type: timestamp
              - column:
                  name: paid_at
                  type: timestamp

        - addForeignKeyConstraint:
            baseTableName: payments
            baseColumnNames: booking_id
            referencedTableName: bookings
            referencedColumnNames: id
            constraintName: fk_payments_booking

  - changeSet:
      id: 005-create-events
      author: Oleksii Morenets
      changes:
        - createTable:
            tableName: events
            columns:
              - column:
                  name: id
                  type: uuid
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: type
                  type: varchar(100)
                  constraints:
                    nullable: false
              - column:
                  name: payload
                  type: text
              - column:
                  name: created_at
                  type: timestamp
                  constraints:
                    nullable: false

  - changeSet:
      id: 006-insert-initial-units
      author: Oleksii Morenets
      changes:
        - sql:
            sql: |
              INSERT INTO units (id, rooms, type, floor, base_cost, description, active)
              VALUES
              (gen_random_uuid(), 1, 'HOME', 1, 80.00, 'Small home unit', true),
              (gen_random_uuid(), 2, 'FLAT', 2, 120.00, 'City flat', true),
              (gen_random_uuid(), 3, 'APARTMENTS', 5, 200.00, 'Large apartments', true),
              (gen_random_uuid(), 1, 'FLAT', 3, 90.00, 'Studio flat', true),
              (gen_random_uuid(), 2, 'HOME', 1, 110.00, 'Comfort home', true),
              (gen_random_uuid(), 4, 'APARTMENTS', 7, 250.00, 'Luxury apartments', true),
              (gen_random_uuid(), 3, 'FLAT', 4, 160.00, 'Family flat', true),
              (gen_random_uuid(), 2, 'HOME', 2, 100.00, 'Quiet home', true),
              (gen_random_uuid(), 1, 'APARTMENTS', 6, 95.00, 'Budget apartments', true),
              (gen_random_uuid(), 3, 'HOME', 1, 180.00, 'Spacious home', true);

  - changeSet:
      id: 007-insert-unit-events
      author: Oleksii Morenets
      changes:
        - sql:
            sql: |
              INSERT INTO events (id, type, payload, created_at)
              SELECT
                gen_random_uuid(),
                'UNIT_CREATED',
                'Initial unit created',
                now()
              FROM units
              LIMIT 10;
